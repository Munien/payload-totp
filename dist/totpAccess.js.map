{"version":3,"sources":["../src/totpAccess.ts"],"sourcesContent":["import type { Access, BasePayload } from 'payload'\n\nimport type { UserWithTotp } from './types.js'\n\nexport const totpAccess: (innerAccess?: Access) => Access = (innerAccess) => {\n\treturn async (args) => {\n\t\tconst {\n\t\t\treq: {\n\t\t\t\tpayload: {\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tcustom: {\n\t\t\t\t\t\t\ttotp: { pluginOptions },\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tuser,\n\t\t\t},\n\t\t} = args as unknown as { req: { payload: BasePayload; user: UserWithTotp } }\n\n\t\tif (!user) {\n\t\t\treturn false\n\t\t}\n\n\t\tif (pluginOptions.disableAccessWrapper) {\n\t\t\treturn innerAccess ? innerAccess(args) : true\n\t\t}\n\n\t\tif (\n\t\t\t(pluginOptions.forceSetup && (<any>user)._strategy === 'totp') ||\n\t\t\t(<any>user)._strategy === 'api-key'\n\t\t) {\n\t\t\treturn innerAccess ? innerAccess(args) : true\n\t\t} else {\n\t\t\tif (user.hasTotp) {\n\t\t\t\tif ((<any>user)._strategy === 'totp') {\n\t\t\t\t\treturn innerAccess ? innerAccess(args) : true\n\t\t\t\t} else {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn innerAccess ? innerAccess(args) : true\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["totpAccess","innerAccess","args","req","payload","config","custom","totp","pluginOptions","user","disableAccessWrapper","forceSetup","_strategy","hasTotp"],"mappings":"AAIA,OAAO,MAAMA,aAA+C,CAACC;IAC5D,OAAO,OAAOC;QACb,MAAM,EACLC,KAAK,EACJC,SAAS,EACRC,QAAQ,EACPC,QAAQ,EACPC,MAAM,EAAEC,aAAa,EAAE,EACvB,EACD,EACD,EACDC,IAAI,EACJ,EACD,GAAGP;QAEJ,IAAI,CAACO,MAAM;YACV,OAAO;QACR;QAEA,IAAID,cAAcE,oBAAoB,EAAE;YACvC,OAAOT,cAAcA,YAAYC,QAAQ;QAC1C;QAEA,IACC,AAACM,cAAcG,UAAU,IAAI,AAAMF,KAAMG,SAAS,KAAK,UACvD,AAAMH,KAAMG,SAAS,KAAK,WACzB;YACD,OAAOX,cAAcA,YAAYC,QAAQ;QAC1C,OAAO;YACN,IAAIO,KAAKI,OAAO,EAAE;gBACjB,IAAI,AAAMJ,KAAMG,SAAS,KAAK,QAAQ;oBACrC,OAAOX,cAAcA,YAAYC,QAAQ;gBAC1C,OAAO;oBACN,OAAO;gBACR;YACD,OAAO;gBACN,OAAOD,cAAcA,YAAYC,QAAQ;YAC1C;QACD;IACD;AACD,EAAC"}