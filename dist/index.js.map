{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { CheckboxField, Config, TextField, UIField } from 'payload'\n\nimport type { PayloadTOTPConfig } from './types.js'\n\nimport { removeEndpointHandler } from './api/remove.js'\nimport { setSecret } from './api/setSecret.js'\nimport { verifyToken } from './api/verifyToken.js'\nimport { deleteCookieAfterLogout } from './hooks/deleteCookieAfterLogout.js'\nimport { setHasTotp } from './hooks/setHasTotp.js'\nimport { i18n } from './i18n/index.js'\nimport { strategy } from './strategy.js'\nimport { totpAccess } from './totpAccess.js'\n\nconst payloadTotp =\n\t(pluginOptions: PayloadTOTPConfig) =>\n\t(config: Config): Config => {\n\t\treturn {\n\t\t\t...config,\n\t\t\tadmin: {\n\t\t\t\t...(config.admin || {}),\n\t\t\t\tcomponents: {\n\t\t\t\t\t...(config.admin?.components || {}),\n\t\t\t\t\tproviders: [\n\t\t\t\t\t\t...(config.admin?.components?.providers || []),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpath: 'payload-totp/rsc#TOTPProvider',\n\t\t\t\t\t\t\tserverProps: {\n\t\t\t\t\t\t\t\tpluginOptions,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tviews: {\n\t\t\t\t\t\t// Backslash versions are standard and works in general.\n\t\t\t\t\t\t// But it doesn't work well when you're using PayloadCMS\n\t\t\t\t\t\t// without `/admin`, but `/`.\n\t\t\t\t\t\tSetupTOTP: {\n\t\t\t\t\t\t\tComponent: {\n\t\t\t\t\t\t\t\tpath: 'payload-totp/rsc#TOTPSetup',\n\t\t\t\t\t\t\t\tserverProps: {\n\t\t\t\t\t\t\t\t\tpluginOptions,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texact: true,\n\t\t\t\t\t\t\tpath: '/setup-totp',\n\t\t\t\t\t\t\tsensitive: false,\n\t\t\t\t\t\t\tstrict: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tSetupTOTPBackslash: {\n\t\t\t\t\t\t\tComponent: {\n\t\t\t\t\t\t\t\tpath: 'payload-totp/rsc#TOTPSetup',\n\t\t\t\t\t\t\t\tserverProps: {\n\t\t\t\t\t\t\t\t\tpluginOptions,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texact: true,\n\t\t\t\t\t\t\tpath: '/setup-totp',\n\t\t\t\t\t\t\tsensitive: false,\n\t\t\t\t\t\t\tstrict: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tVerifyTOTP: {\n\t\t\t\t\t\t\tComponent: {\n\t\t\t\t\t\t\t\tpath: 'payload-totp/rsc#TOTPVerify',\n\t\t\t\t\t\t\t\tserverProps: {\n\t\t\t\t\t\t\t\t\tpluginOptions,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texact: true,\n\t\t\t\t\t\t\tpath: '/verify-totp',\n\t\t\t\t\t\t\tsensitive: false,\n\t\t\t\t\t\t\tstrict: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tVerifyTOTPBackslash: {\n\t\t\t\t\t\t\tComponent: {\n\t\t\t\t\t\t\t\tpath: 'payload-totp/rsc#TOTPVerify',\n\t\t\t\t\t\t\t\tserverProps: {\n\t\t\t\t\t\t\t\t\tpluginOptions,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texact: true,\n\t\t\t\t\t\t\tpath: '/verify-totp',\n\t\t\t\t\t\t\tsensitive: false,\n\t\t\t\t\t\t\tstrict: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// Fix for https://github.com/GeorgeHulpoi/payload-totp/issues/46\n\t\t\t\t\t\t// The order is important!\n\t\t\t\t\t\t...(config.admin?.components?.views || {}),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tcollections: [\n\t\t\t\t...(config.collections || []).map((collection) => {\n\t\t\t\t\tif (collection.slug === pluginOptions.collection) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...collection,\n\t\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t\t...(collection.access || {}),\n\t\t\t\t\t\t\t\tcreate:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.create\n\t\t\t\t\t\t\t\t\t\t? collection.access?.create\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.create),\n\t\t\t\t\t\t\t\tdelete:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.delete\n\t\t\t\t\t\t\t\t\t\t? collection.access?.delete\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.delete),\n\t\t\t\t\t\t\t\tread:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.read\n\t\t\t\t\t\t\t\t\t\t? collection.access?.read\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.read),\n\t\t\t\t\t\t\t\treadVersions:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.readVersions\n\t\t\t\t\t\t\t\t\t\t? collection.access?.readVersions\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.readVersions),\n\t\t\t\t\t\t\t\tunlock:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.unlock\n\t\t\t\t\t\t\t\t\t\t? collection.access?.unlock\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.unlock),\n\t\t\t\t\t\t\t\tupdate:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.update\n\t\t\t\t\t\t\t\t\t\t? collection.access?.update\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.update),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauth: {\n\t\t\t\t\t\t\t\t...(typeof collection.auth === 'object' ? collection.auth : {}),\n\t\t\t\t\t\t\t\tstrategies: [\n\t\t\t\t\t\t\t\t\tstrategy,\n\t\t\t\t\t\t\t\t\t...(typeof collection.auth === 'object'\n\t\t\t\t\t\t\t\t\t\t? collection.auth?.strategies || []\n\t\t\t\t\t\t\t\t\t\t: []),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t\t...(collection.fields || []),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'totpSecret',\n\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t\t\t\tcreate: () => false,\n\t\t\t\t\t\t\t\t\t\tread: () => false,\n\t\t\t\t\t\t\t\t\t\tupdate: () => false,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tadmin: {\n\t\t\t\t\t\t\t\t\t\tdisableBulkEdit: true,\n\t\t\t\t\t\t\t\t\t\tdisableListColumn: true,\n\t\t\t\t\t\t\t\t\t\tdisableListFilter: true,\n\t\t\t\t\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdisableBulkEdit: true,\n\t\t\t\t\t\t\t\t\tdisableListColumn: true,\n\t\t\t\t\t\t\t\t\tdisableListFilter: true,\n\t\t\t\t\t\t\t\t} as TextField,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'totpSecretUI',\n\t\t\t\t\t\t\t\t\ttype: 'ui',\n\t\t\t\t\t\t\t\t\tadmin: {\n\t\t\t\t\t\t\t\t\t\tcomponents: {\n\t\t\t\t\t\t\t\t\t\t\tField: {\n\t\t\t\t\t\t\t\t\t\t\t\tpath: 'payload-totp/rsc#TOTPField',\n\t\t\t\t\t\t\t\t\t\t\t\tserverProps: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpluginOptions,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdisableListColumn: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t} as UIField,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'hasTotp',\n\t\t\t\t\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t\t\t\tread: ({ data, req: { user } }) =>\n\t\t\t\t\t\t\t\t\t\t\tdata && user && data?.id === user?.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tadmin: {\n\t\t\t\t\t\t\t\t\t\tdisableBulkEdit: true,\n\t\t\t\t\t\t\t\t\t\tdisableListColumn: true,\n\t\t\t\t\t\t\t\t\t\tdisableListFilter: true,\n\t\t\t\t\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thooks: {\n\t\t\t\t\t\t\t\t\t\tafterRead: [setHasTotp(pluginOptions)],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tvirtual: true,\n\t\t\t\t\t\t\t\t} as CheckboxField,\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\thooks: {\n\t\t\t\t\t\t\t\t...(collection.hooks || {}),\n\t\t\t\t\t\t\t\tafterLogout: [\n\t\t\t\t\t\t\t\t\t...(collection.hooks?.afterLogout || []),\n\t\t\t\t\t\t\t\t\tdeleteCookieAfterLogout,\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...collection,\n\t\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t\t...(collection.access || {}),\n\t\t\t\t\t\t\t\tcreate:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.create\n\t\t\t\t\t\t\t\t\t\t? collection.access?.create\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.create),\n\t\t\t\t\t\t\t\tdelete:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.delete\n\t\t\t\t\t\t\t\t\t\t? collection.access?.delete\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.delete),\n\t\t\t\t\t\t\t\tread:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.read\n\t\t\t\t\t\t\t\t\t\t? collection.access?.read\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.read),\n\t\t\t\t\t\t\t\treadVersions:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.readVersions\n\t\t\t\t\t\t\t\t\t\t? collection.access?.readVersions\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.readVersions),\n\t\t\t\t\t\t\t\tunlock:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.unlock\n\t\t\t\t\t\t\t\t\t\t? collection.access?.unlock\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.unlock),\n\t\t\t\t\t\t\t\tupdate:\n\t\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\t\tcollection.custom?.totp?.disableAccessWrapper?.update\n\t\t\t\t\t\t\t\t\t\t? collection.access?.update\n\t\t\t\t\t\t\t\t\t\t: totpAccess(collection.access?.update),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tcustom: {\n\t\t\t\t...(config.custom || {}),\n\t\t\t\ttotp: {\n\t\t\t\t\tpluginOptions,\n\t\t\t\t},\n\t\t\t},\n\t\t\tendpoints: [\n\t\t\t\t...(config.endpoints || []),\n\t\t\t\t{\n\t\t\t\t\thandler: setSecret(pluginOptions),\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tpath: '/setup-totp',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\thandler: verifyToken(pluginOptions),\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tpath: '/verify-totp',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\thandler: removeEndpointHandler(pluginOptions),\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tpath: '/remove-totp',\n\t\t\t\t},\n\t\t\t],\n\t\t\tglobals: [\n\t\t\t\t...(config.globals || []).map((global) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...global,\n\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t...(global.access || {}),\n\t\t\t\t\t\t\tread:\n\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\tglobal.custom?.totp?.disableAccessWrapper?.read\n\t\t\t\t\t\t\t\t\t? global.access?.read\n\t\t\t\t\t\t\t\t\t: totpAccess(global.access?.read),\n\t\t\t\t\t\t\treadDrafts:\n\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\tglobal.custom?.totp?.disableAccessWrapper?.readDrafts\n\t\t\t\t\t\t\t\t\t? global.access?.readDrafts\n\t\t\t\t\t\t\t\t\t: totpAccess(global.access?.readDrafts),\n\t\t\t\t\t\t\treadVersions:\n\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\tglobal.custom?.totp?.disableAccessWrapper?.readVersions\n\t\t\t\t\t\t\t\t\t? global.access?.readVersions\n\t\t\t\t\t\t\t\t\t: totpAccess(global.access?.readVersions),\n\t\t\t\t\t\t\tupdate:\n\t\t\t\t\t\t\t\tpluginOptions.disableAccessWrapper ||\n\t\t\t\t\t\t\t\tglobal.custom?.totp?.disableAccessWrapper?.update\n\t\t\t\t\t\t\t\t\t? global.access?.update\n\t\t\t\t\t\t\t\t\t: totpAccess(global.access?.update),\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\ti18n: i18n(config.i18n),\n\t\t}\n\t}\n\nexport { payloadTotp, totpAccess }\n"],"names":["removeEndpointHandler","setSecret","verifyToken","deleteCookieAfterLogout","setHasTotp","i18n","strategy","totpAccess","payloadTotp","pluginOptions","config","admin","components","providers","path","serverProps","views","SetupTOTP","Component","exact","sensitive","strict","SetupTOTPBackslash","VerifyTOTP","VerifyTOTPBackslash","collections","map","collection","slug","access","create","disableAccessWrapper","custom","totp","delete","read","readVersions","unlock","update","auth","strategies","fields","name","type","disableBulkEdit","disableListColumn","disableListFilter","hidden","Field","data","req","user","id","hooks","afterRead","virtual","afterLogout","endpoints","handler","method","globals","global","readDrafts"],"mappings":"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"}