{"version":3,"sources":["../../../../src/components/views/Remove/Form.tsx"],"sourcesContent":["/* eslint-disable no-restricted-exports */\n\n'use client'\n\nimport { toast } from '@payloadcms/ui'\nimport React, { useCallback, useRef, useState } from 'react'\n\nimport type { IResponse } from '../../../api/verifyToken.js'\n\nimport OTPInput from '../../OTPInput/index.js'\n\ntype Args = {\n\tapiRoute: string\n\tlength?: number\n\tserverURL: string\n}\n\nexport default function OTPForm({ apiRoute, length, serverURL }: Args) {\n\tconst [isPending, setIsPending] = useState(false)\n\tconst form = useRef<HTMLFormElement>(null)\n\n\tconst onFilled = () => {\n\t\tif (form.current) {\n\t\t\tform.current.requestSubmit()\n\t\t}\n\t}\n\n\tconst asyncOperation = useCallback(\n\t\tasync (event: React.FormEvent<HTMLFormElement>) => {\n\t\t\tevent.preventDefault()\n\t\t\tevent.stopPropagation()\n\n\t\t\tsetIsPending(true)\n\n\t\t\tconst formData = new FormData(event.target as HTMLFormElement)\n\n\t\t\tconst res = await fetch(`${serverURL}${apiRoute}/remove-totp`, {\n\t\t\t\tbody: JSON.stringify(Object.fromEntries(formData)),\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tmethod: 'post',\n\t\t\t})\n\n\t\t\tconst data = (await res.json()) as IResponse\n\n\t\t\tif (!data.ok && data.message) {\n\t\t\t\ttoast.error(data.message)\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\treturn true\n\t\t},\n\t\t[apiRoute, serverURL],\n\t)\n\n\tconst handleSubmit: React.FormEventHandler<HTMLFormElement> = useCallback(\n\t\t(event) => {\n\t\t\tasyncOperation(event)\n\t\t\t\t.then((ok) => {\n\t\t\t\t\tif (ok) {\n\t\t\t\t\t\tlocation.reload()\n\t\t\t\t\t}\n\t\t\t\t\tsetIsPending(false)\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.error(err)\n\t\t\t\t\ttoast.error('Something went wrong')\n\t\t\t\t\tsetIsPending(false)\n\t\t\t\t})\n\t\t},\n\t\t[asyncOperation],\n\t)\n\n\treturn (\n\t\t<form onSubmit={handleSubmit} ref={form}>\n\t\t\t<OTPInput disabled={isPending} length={length} name=\"token\" onFilled={onFilled} />\n\t\t</form>\n\t)\n}\n"],"names":["toast","React","useCallback","useRef","useState","OTPInput","OTPForm","apiRoute","length","serverURL","isPending","setIsPending","form","onFilled","current","requestSubmit","asyncOperation","event","preventDefault","stopPropagation","formData","FormData","target","res","fetch","body","JSON","stringify","Object","fromEntries","credentials","headers","method","data","json","ok","message","error","handleSubmit","then","location","reload","catch","err","console","onSubmit","ref","disabled","name"],"mappings":"AAAA,wCAAwC,GAExC;;AAEA,SAASA,KAAK,QAAQ,iBAAgB;AACtC,OAAOC,SAASC,WAAW,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,QAAO;AAI5D,OAAOC,cAAc,0BAAyB;AAQ9C,eAAe,SAASC,QAAQ,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAQ;IACpE,MAAM,CAACC,WAAWC,aAAa,GAAGP,SAAS;IAC3C,MAAMQ,OAAOT,OAAwB;IAErC,MAAMU,WAAW;QAChB,IAAID,KAAKE,OAAO,EAAE;YACjBF,KAAKE,OAAO,CAACC,aAAa;QAC3B;IACD;IAEA,MAAMC,iBAAiBd,YACtB,OAAOe;QACNA,MAAMC,cAAc;QACpBD,MAAME,eAAe;QAErBR,aAAa;QAEb,MAAMS,WAAW,IAAIC,SAASJ,MAAMK,MAAM;QAE1C,MAAMC,MAAM,MAAMC,MAAM,GAAGf,YAAYF,SAAS,YAAY,CAAC,EAAE;YAC9DkB,MAAMC,KAAKC,SAAS,CAACC,OAAOC,WAAW,CAACT;YACxCU,aAAa;YACbC,SAAS;gBACR,gBAAgB;YACjB;YACAC,QAAQ;QACT;QAEA,MAAMC,OAAQ,MAAMV,IAAIW,IAAI;QAE5B,IAAI,CAACD,KAAKE,EAAE,IAAIF,KAAKG,OAAO,EAAE;YAC7BpC,MAAMqC,KAAK,CAACJ,KAAKG,OAAO;YACxB,OAAO;QACR;QAEA,OAAO;IACR,GACA;QAAC7B;QAAUE;KAAU;IAGtB,MAAM6B,eAAwDpC,YAC7D,CAACe;QACAD,eAAeC,OACbsB,IAAI,CAAC,CAACJ;YACN,IAAIA,IAAI;gBACPK,SAASC,MAAM;YAChB;YACA9B,aAAa;QACd,GACC+B,KAAK,CAAC,CAACC;YACP,sCAAsC;YACtCC,QAAQP,KAAK,CAACM;YACd3C,MAAMqC,KAAK,CAAC;YACZ1B,aAAa;QACd;IACF,GACA;QAACK;KAAe;IAGjB,qBACC,KAACJ;QAAKiC,UAAUP;QAAcQ,KAAKlC;kBAClC,cAAA,KAACP;YAAS0C,UAAUrC;YAAWF,QAAQA;YAAQwC,MAAK;YAAQnC,UAAUA;;;AAGzE"}