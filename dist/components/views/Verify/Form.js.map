{"version":3,"sources":["../../../../src/components/views/Verify/Form.tsx"],"sourcesContent":["/* eslint-disable no-restricted-exports */\n\n'use client'\n\nimport { toast } from '@payloadcms/ui'\nimport React, { useCallback, useRef, useState } from 'react'\n\nimport type { IResponse } from '../../../api/verifyToken.js'\n\nimport OTPInput from '../../OTPInput/index.js'\n\ntype Args = {\n\tapiRoute: string\n\tback?: string\n\tlength?: number\n\tserverURL: string\n}\n\nexport default function OTPForm({ apiRoute, back, length, serverURL }: Args) {\n\tconst [isPending, setIsPending] = useState(false)\n\tconst form = useRef<HTMLFormElement>(null)\n\n\tconst onFilled = () => {\n\t\tif (form.current) {\n\t\t\tform.current.requestSubmit()\n\t\t}\n\t}\n\n\tconst asyncOperation = useCallback(\n\t\tasync (event: React.FormEvent<HTMLFormElement>) => {\n\t\t\tevent.preventDefault()\n\t\t\tevent.stopPropagation()\n\n\t\t\tsetIsPending(true)\n\n\t\t\tconst formData = new FormData(event.target as HTMLFormElement)\n\n\t\t\tconst res = await fetch(`${serverURL}${apiRoute}/verify-totp`, {\n\t\t\t\tbody: JSON.stringify(Object.fromEntries(formData)),\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tmethod: 'post',\n\t\t\t})\n\n\t\t\tconst data = (await res.json()) as IResponse\n\n\t\t\tif (!data.ok && data.message) {\n\t\t\t\ttoast.error(data.message)\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\treturn true\n\t\t},\n\t\t[serverURL, apiRoute],\n\t)\n\n\tconst handleSubmit: React.FormEventHandler<HTMLFormElement> = useCallback(\n\t\t(event) => {\n\t\t\tasyncOperation(event)\n\t\t\t\t.then((ok) => {\n\t\t\t\t\tif (ok) {\n\t\t\t\t\t\tif (back) {\n\t\t\t\t\t\t\t// Use location, auth strategy must run again\n\t\t\t\t\t\t\tlocation.replace(back)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.history.back()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsetIsPending(false)\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.error(err)\n\t\t\t\t\ttoast.error('Something went wrong')\n\t\t\t\t\tsetIsPending(false)\n\t\t\t\t})\n\t\t},\n\t\t[back, asyncOperation],\n\t)\n\n\treturn (\n\t\t<form onSubmit={handleSubmit} ref={form}>\n\t\t\t<OTPInput disabled={isPending} length={length} name=\"token\" onFilled={onFilled} />\n\t\t</form>\n\t)\n}\n"],"names":["toast","React","useCallback","useRef","useState","OTPInput","OTPForm","apiRoute","back","length","serverURL","isPending","setIsPending","form","onFilled","current","requestSubmit","asyncOperation","event","preventDefault","stopPropagation","formData","FormData","target","res","fetch","body","JSON","stringify","Object","fromEntries","credentials","headers","method","data","json","ok","message","error","handleSubmit","then","location","replace","window","history","catch","err","console","onSubmit","ref","disabled","name"],"mappings":"AAAA,wCAAwC,GAExC;;AAEA,SAASA,KAAK,QAAQ,iBAAgB;AACtC,OAAOC,SAASC,WAAW,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,QAAO;AAI5D,OAAOC,cAAc,0BAAyB;AAS9C,eAAe,SAASC,QAAQ,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,MAAM,EAAEC,SAAS,EAAQ;IAC1E,MAAM,CAACC,WAAWC,aAAa,GAAGR,SAAS;IAC3C,MAAMS,OAAOV,OAAwB;IAErC,MAAMW,WAAW;QAChB,IAAID,KAAKE,OAAO,EAAE;YACjBF,KAAKE,OAAO,CAACC,aAAa;QAC3B;IACD;IAEA,MAAMC,iBAAiBf,YACtB,OAAOgB;QACNA,MAAMC,cAAc;QACpBD,MAAME,eAAe;QAErBR,aAAa;QAEb,MAAMS,WAAW,IAAIC,SAASJ,MAAMK,MAAM;QAE1C,MAAMC,MAAM,MAAMC,MAAM,GAAGf,YAAYH,SAAS,YAAY,CAAC,EAAE;YAC9DmB,MAAMC,KAAKC,SAAS,CAACC,OAAOC,WAAW,CAACT;YACxCU,aAAa;YACbC,SAAS;gBACR,gBAAgB;YACjB;YACAC,QAAQ;QACT;QAEA,MAAMC,OAAQ,MAAMV,IAAIW,IAAI;QAE5B,IAAI,CAACD,KAAKE,EAAE,IAAIF,KAAKG,OAAO,EAAE;YAC7BrC,MAAMsC,KAAK,CAACJ,KAAKG,OAAO;YACxB,OAAO;QACR;QAEA,OAAO;IACR,GACA;QAAC3B;QAAWH;KAAS;IAGtB,MAAMgC,eAAwDrC,YAC7D,CAACgB;QACAD,eAAeC,OACbsB,IAAI,CAAC,CAACJ;YACN,IAAIA,IAAI;gBACP,IAAI5B,MAAM;oBACT,6CAA6C;oBAC7CiC,SAASC,OAAO,CAAClC;gBAClB,OAAO;oBACNmC,OAAOC,OAAO,CAACpC,IAAI;gBACpB;YACD;YACAI,aAAa;QACd,GACCiC,KAAK,CAAC,CAACC;YACP,sCAAsC;YACtCC,QAAQT,KAAK,CAACQ;YACd9C,MAAMsC,KAAK,CAAC;YACZ1B,aAAa;QACd;IACF,GACA;QAACJ;QAAMS;KAAe;IAGvB,qBACC,KAACJ;QAAKmC,UAAUT;QAAcU,KAAKpC;kBAClC,cAAA,KAACR;YAAS6C,UAAUvC;YAAWF,QAAQA;YAAQ0C,MAAK;YAAQrC,UAAUA;;;AAGzE"}