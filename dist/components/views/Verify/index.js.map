{"version":3,"sources":["../../../../src/components/views/Verify/index.tsx"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type { AdminViewProps, ServerComponentProps } from 'payload'\n\nimport { MinimalTemplate } from '@payloadcms/next/templates'\nimport { formatAdminURL } from '@payloadcms/ui/shared'\nimport { redirect } from 'next/navigation.js'\n\nimport type { CustomTranslationsKeys, CustomTranslationsObject } from '../../../i18n/types.js'\nimport type { PayloadTOTPConfig, UserWithTotp } from '../../../types.js'\n\nimport Form from './Form.js'\nimport styles from './index.module.css'\n\ntype Args = {\n\tpluginOptions: PayloadTOTPConfig\n} & AdminViewProps &\n\tServerComponentProps\n\nexport const TOTPVerify: React.FC<Args> = (args) => {\n\tconst i18n = args.i18n as I18nClient<CustomTranslationsObject, CustomTranslationsKeys>\n\tconst {\n\t\tinitPageResult: {\n\t\t\treq: {\n\t\t\t\tpayload: {\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\troutes: { admin: adminRoute, api: apiRoute },\n\t\t\t\t\t\tserverURL,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tuser: _user,\n\t\t\t},\n\t\t},\n\t\tpluginOptions,\n\t\tsearchParams: { back } = {},\n\t} = args\n\n\tconst user = _user as unknown as UserWithTotp\n\n\tif (!user) {\n\t\tconst url = formatAdminURL({\n\t\t\tadminRoute,\n\t\t\tpath: '/login',\n\t\t\tserverURL,\n\t\t})\n\n\t\tredirect(url)\n\t}\n\n\tif (!user.hasTotp || (user.hasTotp && (user as any).strategy === 'totp')) {\n\t\tconst url = formatAdminURL({\n\t\t\tadminRoute,\n\t\t\tpath: '/',\n\t\t\tserverURL,\n\t\t})\n\n\t\tredirect(url)\n\t}\n\n\treturn (\n\t\t<MinimalTemplate className={styles.root}>\n\t\t\t<h1>{i18n.t('totpPlugin:verify:title')}</h1>\n\t\t\t<p>\n\t\t\t\t{i18n\n\t\t\t\t\t.t('totpPlugin:setup:enterCode')\n\t\t\t\t\t.replace('{digits}', (pluginOptions.totp?.digits || 6).toString())}\n\t\t\t</p>\n\t\t\t<Form\n\t\t\t\tapiRoute={apiRoute}\n\t\t\t\tback={(typeof back === 'string' && back) || undefined}\n\t\t\t\tlength={pluginOptions.totp?.digits}\n\t\t\t\tserverURL={serverURL}\n\t\t\t/>\n\t\t</MinimalTemplate>\n\t)\n}\n"],"names":["MinimalTemplate","formatAdminURL","redirect","Form","styles","TOTPVerify","args","i18n","initPageResult","req","payload","config","routes","admin","adminRoute","api","apiRoute","serverURL","user","_user","pluginOptions","searchParams","back","url","path","hasTotp","strategy","className","root","h1","t","p","replace","totp","digits","toString","undefined","length"],"mappings":";AAGA,SAASA,eAAe,QAAQ,6BAA4B;AAC5D,SAASC,cAAc,QAAQ,wBAAuB;AACtD,SAASC,QAAQ,QAAQ,qBAAoB;AAK7C,OAAOC,UAAU,YAAW;AAC5B,OAAOC,YAAY,qBAAoB;AAOvC,OAAO,MAAMC,aAA6B,CAACC;IAC1C,MAAMC,OAAOD,KAAKC,IAAI;IACtB,MAAM,EACLC,gBAAgB,EACfC,KAAK,EACJC,SAAS,EACRC,QAAQ,EACPC,QAAQ,EAAEC,OAAOC,UAAU,EAAEC,KAAKC,QAAQ,EAAE,EAC5CC,SAAS,EACT,EACD,EACDC,MAAMC,KAAK,EACX,EACD,EACDC,aAAa,EACbC,cAAc,EAAEC,IAAI,EAAE,GAAG,CAAC,CAAC,EAC3B,GAAGhB;IAEJ,MAAMY,OAAOC;IAEb,IAAI,CAACD,MAAM;QACV,MAAMK,MAAMtB,eAAe;YAC1Ba;YACAU,MAAM;YACNP;QACD;QAEAf,SAASqB;IACV;IAEA,IAAI,CAACL,KAAKO,OAAO,IAAKP,KAAKO,OAAO,IAAI,AAACP,KAAaQ,QAAQ,KAAK,QAAS;QACzE,MAAMH,MAAMtB,eAAe;YAC1Ba;YACAU,MAAM;YACNP;QACD;QAEAf,SAASqB;IACV;IAEA,qBACC,MAACvB;QAAgB2B,WAAWvB,OAAOwB,IAAI;;0BACtC,KAACC;0BAAItB,KAAKuB,CAAC,CAAC;;0BACZ,KAACC;0BACCxB,KACCuB,CAAC,CAAC,8BACFE,OAAO,CAAC,YAAY,AAACZ,CAAAA,cAAca,IAAI,EAAEC,UAAU,CAAA,EAAGC,QAAQ;;0BAEjE,KAAChC;gBACAa,UAAUA;gBACVM,MAAM,AAAC,OAAOA,SAAS,YAAYA,QAASc;gBAC5CC,QAAQjB,cAAca,IAAI,EAAEC;gBAC5BjB,WAAWA;;;;AAIf,EAAC"}