{"version":3,"sources":["../src/setCookie.ts"],"sourcesContent":["import jwt from 'jsonwebtoken'\nimport { cookies } from 'next/headers.js'\nimport { getCookieExpiration, type IncomingAuthType, type User } from 'payload'\n\ntype Args = {\n\tauthConfig: Omit<IncomingAuthType, 'cookies'> & Required<Pick<IncomingAuthType, 'cookies'>>\n\tcookiePrefix: string\n\tsecret: string\n\tuser: User\n}\n\nexport async function setCookie({ authConfig, cookiePrefix, secret, user }: Args) {\n\tconst token = jwt.sign(\n\t\t{\n\t\t\toriginalStrategy: (<any>user)._strategy,\n\t\t\tuserId: user.id,\n\t\t},\n\t\tsecret,\n\t\t{\n\t\t\texpiresIn: authConfig.tokenExpiration || 7200,\n\t\t},\n\t)\n\n\tconst sameSite =\n\t\ttypeof authConfig.cookies.sameSite === 'string'\n\t\t\t? (authConfig.cookies.sameSite.toLocaleLowerCase() as 'lax' | 'none' | 'strict')\n\t\t\t: authConfig.cookies.sameSite\n\t\t\t\t? 'strict'\n\t\t\t\t: undefined\n\n\tconst cookieStore = await cookies()\n\n\tcookieStore.set(`${cookiePrefix}-totp`, token, {\n\t\tdomain: authConfig.cookies.domain ?? undefined,\n\t\texpires: getCookieExpiration({\n\t\t\tseconds: authConfig.tokenExpiration || 7200,\n\t\t}),\n\t\thttpOnly: true,\n\t\tpath: '/',\n\t\tsameSite,\n\t\tsecure: authConfig.cookies.secure,\n\t})\n}\n"],"names":["jwt","cookies","getCookieExpiration","setCookie","authConfig","cookiePrefix","secret","user","token","sign","originalStrategy","_strategy","userId","id","expiresIn","tokenExpiration","sameSite","toLocaleLowerCase","undefined","cookieStore","set","domain","expires","seconds","httpOnly","path","secure"],"mappings":"AAAA,OAAOA,SAAS,eAAc;AAC9B,SAASC,OAAO,QAAQ,kBAAiB;AACzC,SAASC,mBAAmB,QAA0C,UAAS;AAS/E,OAAO,eAAeC,UAAU,EAAEC,UAAU,EAAEC,YAAY,EAAEC,MAAM,EAAEC,IAAI,EAAQ;IAC/E,MAAMC,QAAQR,IAAIS,IAAI,CACrB;QACCC,kBAAkB,AAAMH,KAAMI,SAAS;QACvCC,QAAQL,KAAKM,EAAE;IAChB,GACAP,QACA;QACCQ,WAAWV,WAAWW,eAAe,IAAI;IAC1C;IAGD,MAAMC,WACL,OAAOZ,WAAWH,OAAO,CAACe,QAAQ,KAAK,WACnCZ,WAAWH,OAAO,CAACe,QAAQ,CAACC,iBAAiB,KAC9Cb,WAAWH,OAAO,CAACe,QAAQ,GAC1B,WACAE;IAEL,MAAMC,cAAc,MAAMlB;IAE1BkB,YAAYC,GAAG,CAAC,GAAGf,aAAa,KAAK,CAAC,EAAEG,OAAO;QAC9Ca,QAAQjB,WAAWH,OAAO,CAACoB,MAAM,IAAIH;QACrCI,SAASpB,oBAAoB;YAC5BqB,SAASnB,WAAWW,eAAe,IAAI;QACxC;QACAS,UAAU;QACVC,MAAM;QACNT;QACAU,QAAQtB,WAAWH,OAAO,CAACyB,MAAM;IAClC;AACD"}